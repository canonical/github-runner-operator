09:00:28 WARNING unexpected facade SSHServer received from the controller
09:00:28 INFO Adding model github-pr-bbd2f-lxd:test-charm-upgrade-4t78 on cloud localhost
09:00:29 WARNING unexpected facade SSHServer received from the controller
09:00:29 WARNING unexpected facade SSHSession received from the controller
09:00:29 WARNING unexpected facade SSHTunneler received from the controller
09:00:29 INFO Deploying fake image builder via any-charm for image ID 1ad6e456-fa35-47ef-988f-1e793a60f258
09:00:32 INFO Deploying ch:amd64/noble/any-charm-124
09:00:51 INFO Deploying local:jammy/github-runner-0
09:00:51 INFO Waiting for model:
  test-aldembmo/0 [allocating] waiting: waiting for machine
  github-runner-image-builder-aldembmo/0 [allocating] waiting: waiting for machine
09:01:21 INFO Waiting for model:
  test-aldembmo/0 [allocating] waiting: waiting for machine
  github-runner-image-builder-aldembmo/0 [executing] maintenance: installing charm software
09:01:51 INFO Waiting for model:
  test-aldembmo/0 [allocating] waiting: waiting for machine
  github-runner-image-builder-aldembmo/0 [idle] active: 
09:02:21 INFO Waiting for model:
  test-aldembmo/0 [allocating] waiting: waiting for machine
09:02:52 INFO Waiting for model:
  test-aldembmo/0 [allocating] waiting: agent initialising
09:03:22 INFO Waiting for model:
  test-aldembmo/0 [executing] maintenance: installing charm software
09:03:52 INFO Waiting for model:
  test-aldembmo/0 [executing] maintenance: Update image for runners
09:04:22 INFO Waiting for model:
  test-aldembmo/0 [executing] maintenance: Update image for runners
09:04:52 INFO Waiting for model:
  test-aldembmo/0 [executing] maintenance: Update image for runners
09:05:22 INFO Waiting for model:
  test-aldembmo/0 [executing] maintenance: Update image for runners
09:05:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:06:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:06:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:07:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:07:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:08:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:08:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:09:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:09:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:10:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:10:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:11:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:11:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:12:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:12:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:13:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:13:52 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:14:22 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:14:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:15:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:15:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:16:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:16:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:17:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:17:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:18:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:18:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:19:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:19:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:20:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:20:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:21:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:21:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:22:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:22:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:23:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:23:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:24:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:24:53 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:25:23 INFO Waiting for model:
  test-aldembmo/0 [idle] error: hook failed: "image-relation-changed"
09:25:54 INFO OpenStack servers: []
09:25:54 INFO Model status:

Model                    Controller           Cloud/Region         Version  SLA          Timestamp
test-charm-upgrade-4t78  github-pr-bbd2f-lxd  localhost/localhost  3.6.13   unsupported  09:25:54Z

App                                   Version  Status  Scale  Charm          Channel      Rev  Exposed  Message
github-runner-image-builder-aldembmo           active      1  any-charm      latest/beta  124  no       
test-aldembmo                                  error       1  github-runner                 0  no       hook failed: "image-relation-changed"

Unit                                     Workload  Agent  Machine  Public address  Ports  Message
github-runner-image-builder-aldembmo/0*  active    idle   0        10.154.182.121         
test-aldembmo/0*                         error     idle   1        10.154.182.143         hook failed: "image-relation-changed"

Machine  State    Address         Inst id        Base          AZ             Message
0        started  10.154.182.121  juju-e04e9d-0  ubuntu@24.04  github-runner  Running
1        started  10.154.182.143  juju-e04e9d-1  ubuntu@22.04  github-runner  Running

09:25:54 INFO Juju error logs:

machine-0: 09:01:15 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-0: 09:01:15 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-1: 09:02:41 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-1: 09:02:41 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-test-aldembmo-0: 09:03:46 ERROR unit.test-aldembmo/0.juju-log Missing image integration.
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 119, in func_with_catch_errors
    func(self, event)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 354, in _on_config_changed
    self._check_image_ready()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 524, in _check_image_ready
    raise ImageIntegrationMissingError("No image integration found")
errors.ImageIntegrationMissingError: No image integration found
unit-test-aldembmo-0: 09:03:47 ERROR unit.test-aldembmo/0.juju-log Missing image integration.
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 119, in func_with_catch_errors
    func(self, event)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 317, in _on_start
    self._check_image_ready()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 524, in _check_image_ready
    raise ImageIntegrationMissingError("No image integration found")
errors.ImageIntegrationMissingError: No image integration found
unit-test-aldembmo-0: 09:05:49 ERROR unit.test-aldembmo/0.juju-log image:1: Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connection.py", line 204, in _new_conn
    sock = connection.create_connection(
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connectionpool.py", line 493, in _make_request
    conn.request(
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connection.py", line 500, in request
    self.endheaders()
  File "/usr/lib/python3.10/http/client.py", line 1298, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/lib/python3.10/http/client.py", line 1058, in _send_output
    self.send(msg)
  File "/usr/lib/python3.10/http/client.py", line 996, in send
    self.connect()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connection.py", line 331, in connect
    self.sock = self._new_conn()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connection.py", line 219, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: HTTPConnection(host='127.0.0.1', port=55555): Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/requests/adapters.py", line 644, in send
    resp = conn.urlopen(
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/urllib3/util/retry.py", line 535, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='127.0.0.1', port=55555): Max retries exceeded with url: /health (Caused by NewConnectionError("HTTPConnection(host='127.0.0.1', port=55555): Failed to establish a new connection: [Errno 111] Connection refused"))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/src/manager_client.py", line 161, in health_check
    response = self._request(_HTTPMethod.GET, "/health", timeout=READ_TIMEOUT)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/src/manager_client.py", line 120, in _request
    response = self._requests.request(method, url, *args, **kwargs)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/requests/adapters.py", line 677, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='127.0.0.1', port=55555): Max retries exceeded with url: /health (Caused by NewConnectionError("HTTPConnection(host='127.0.0.1', port=55555): Failed to establish a new connection: [Errno 111] Connection refused"))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 616, in <module>
    ops.main(GithubRunnerCharm)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/__init__.py", line 360, in __call__
    return _main.main(charm_class=charm_class, use_juju_for_storage=use_juju_for_storage)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/_main.py", line 507, in main
    manager.run()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/_main.py", line 491, in run
    self._emit()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/_main.py", line 426, in _emit
    self._emit_charm_event(self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/_main.py", line 470, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/framework.py", line 337, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/framework.py", line 910, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/venv/ops/framework.py", line 1028, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 119, in func_with_catch_errors
    func(self, event)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 492, in _on_image_relation_changed
    self._setup_service(state)
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/./src/charm.py", line 398, in _setup_service
    self._manager_client.wait_till_ready()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/src/manager_client.py", line 181, in wait_till_ready
    self.health_check()
  File "/var/lib/juju/agents/unit-test-aldembmo-0/charm/src/manager_client.py", line 165, in health_check
    raise RunnerManagerServiceNotReadyError(NOT_READY_ERROR_MESSAGE) from err
errors.RunnerManagerServiceNotReadyError: GitHub runner manager service not ready
unit-test-aldembmo-0: 09:05:50 ERROR juju.worker.uniter.operation hook "image-relation-changed" (via hook dispatching script: dispatch) failed: exit status 1

09:25:54 INFO Forgetting model main...